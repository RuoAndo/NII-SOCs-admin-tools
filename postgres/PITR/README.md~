
# PITR

setting postgresql.conf

<pre>
# diff -u postgresql.conf.bak postgresql.conf                                                
--- postgresql.conf.bak 2017-02-11 16:16:37.094929667 +0900
+++ postgresql.conf     2017-02-11 16:18:54.468058115 +0900
@@ -168,7 +168,7 @@
 
 # - Settings -
 
-#wal_level = minimal                   # minimal, archive, hot_standby, or logical
+wal_level = hot_standby                        # minimal, archive, hot_standby, or logical
                                        # (change requires restart)
 #fsync = on                            # turns forced synchronization on or off
 #synchronous_commit = on               # synchronization level;
@@ -201,9 +201,10 @@
 
 # - Archiving -
 
-#archive_mode = off            # enables archiving; off, on, or always
+archive_mode = on              # enables archiving; off, on, or always
                                # (change requires restart)
-#archive_command = ''          # command to use to archive a logfile segment
+archive_command = 'cp %p /var/lib/postgresql/9.5/main/%f'
+                               # command to use to archive a logfile segment
                                # placeholders: %p = path of file to archive
                                #               %f = file name only
                                # e.g. 'test ! -f /mnt/server/archivedir/%f && cp %p /mnt/server/archivedir/%f'

</pre>

start / stop backup.

<pre>
 2015  python pg_start_backup.py linux405
 2016  python pg_stop_backup.py linux405
</pre>

vmstat -n

procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----
 r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st
 1  4      0 2651692 133672 5076984    0    0  1828  1139  209  611  1  1 73 24  0
 0  2      0 2649152 133676 5079120    0    0  1024 69516  507  968  1  1 25 74  0
 0  1      0 2649856 133676 5078748    0    0     0     0  420  645  0  0 51 48  0
 0  1      0 2624116 133676 5105048    0    0 13056   248  606 1747  1  1 74 25  0
 0  1      0 2587084 133676 5142444    0    0 18432   336  654 1961  1  1 74 24  0
 0  1      0 2551416 133684 5178160    0    0 17536   352  679 2104  1  2 72 25  0
 0  1      0 2510864 133684 5210712    0    0 16000   592  692 1861  2  1 72 24  0
 1  1      0 2453448 133708 5267652    0    0 11520 16652  654 2302  0  2 67 30  0
 0  2      0 2441952 133712 5278760    0    0  5096 82260  549 2217  1  1 57 42  0
 0  1      0 4240200 133760 3479132    0    0    44   304  623 2131  1  4 69 27  0
 0  1      0 4238612 133824 3479708    0    0  5824  1048  836 2487  3  2 73 22  0
 0  1      0 4238060 133896 3481428    0    0  1612   716  805 2243  1  1 73 25  0
 0  2      0 4235608 134772 3481464    0    0  1464   280  802 2321  2  1 69 29  0
 0  1      0 4234388 135672 3483016    0    0  1960   544 1254 3733  2  1 72 26  0
 0  1      0 4232932 136416 3483908    0    0  1252   280  842 2157  1  1 73 25  0
 0  1      0 4231436 137852 3484248    0    0  1436   224  765 1955  1  1 73 26  0
 0  1      0 4229776 139408 3484456    0    0  1548 17276  590 1360  0  0 69 30  0
 0  1      0 4227984 141392 3484544    0    0  1984   152  666 1605  1  1 72 27  0
 0  1      0 4225872 142628 3484892    0    0  1364   144  672 1566  1  1 73 26  0
 0  1      0 4223996 144420 3485344    0    0  1792   224  738 1826  1  1 72 26  0
 0  1      0 4222168 146316 3485748    0    0  1896   256  877 2059  1  1 72 26  0
 0  1      0 4219504 147944 3485944    0    0  1620   280  875 1977  1  1 70 28  0
 0  2      0 4217312 149768 3486040    0    0  1824   168  573 1382  1  1 72 27  0
 0  1      0 4215952 150844 3486080    0    0  1076   152  603 1453  0  0 72 27  0
 0  1      0 4214120 152400 3486412    0    0  1684   200  559 1448  0  1 74 24  0
 0  1      0 4212964 153912 3486500    0    0  1504  1616  593 1486  1  1 72 27  0
 0  2      0 4211816 155364 3486388    0    0  1428   316  524 1169  1  1 65 34  0
 0  1      0 4217404 157344 3486532    0    0  1972   272  523 1333  1  1 74 25  0
 0  1      0 4215264 159192 3486644    0    0  1848   184  520 1299  1  1 74 25  0
 0  3      0 4173320 160300 3520120    0    0  1084 16548  609 1914  1  1 62 36  0
 0  1      0 4180032 161520 3520232    0    0  1204   180  605 1396  0  1 67 32  0
 0  1      0 4178760 162836 3520200    0    0  1316   160  415 1130  1  1 74 25  0
 0  1      0 4177696 163772 3520420    0    0   936   224  624 1616  1  0 74 24  0
 0  1      0 4174868 166028 3521452    0    0  2384   448 1081 2925  1  1 73 25  0
 0  1      0 4173532 166444 3521772    0    0   416   192  619 1511  1  0 73 25  0
 0  1      0 4172880 167536 3521800    0    0  1084   200  527 1416  0  1 70 29  0
 0  1      0 4171432 169128 3521816    0    0  1592   176  589 1481  1  0 73 26  0
